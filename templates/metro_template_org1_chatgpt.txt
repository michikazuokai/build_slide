%----------------------------------------------------------------------------------------
%    PACKAGES AND THEMES (metropolis)
%----------------------------------------------------------------------------------------
%@@notesdocumentmode@@
%\documentclass[notes,aspectratio=169]{beamer}
% \documentclass より後、\usetheme より前
\PassOptionsToPackage{unicode=true,colorlinks=true,linkcolor=blue,urlcolor=blue}{hyperref}
\usetheme{metropolis}
\metroset{block=fill, sectionpage=progressbar, progressbar=foot}

% 背景色を白にする  \setbeamercolor{background canvas}{bg=white}
%@@setbeamcolor@@

% 日本語と基本パッケージ
\usepackage{luatexja}
\usepackage{luatexja-fontspec} % 必要に応じて
\setsansjfont{Hiragino Sans}[BoldFont={Hiragino Sans W6}]
\usepackage[table]{xcolor}
\usepackage{graphicx}
% 共通・個別・ビルド配下すべてを見る（共通は project_assets/images）
\graphicspath{{images/}{../@@sdir@@/images/}{../project_assets/images/}}
\usepackage[abs]{overpic}
\usepackage{minted}
\setminted{
  fontsize=\footnotesize,
  breaklines=true,
  frame=single
}
\usepackage{pifont}
\usepackage{array}
\usepackage{tabularx}
\usepackage{dirtree}
\usepackage{minted}                % mintedを使うので -shell-escape 必須
\usepackage{fontspec}  % lualatex/xeLaTeX用フォント設定
\usepackage{tikz}
\usepackage{graphicx}

\definecolor{ok}{HTML}{2E7D32}
\definecolor{warn}{HTML}{EF6C00}
\definecolor{info}{HTML}{1565C0}
\definecolor{bunrui}{HTML}{4EC2D8}


% 共通・個別・ビルド配下すべてを見る（共通は project_assets/images）
% プリアンブルでベースパスを定義
%%% \newcommand{\assetpath}{/Users/michikazuokai/Library/CloudStorage/GoogleDrive-om036702@ga.ttc.ac.jp/マイドライブ/2025年度/作成_授業資料}
\newcommand{\assetpath}{@@sourcedir@@}
\graphicspath{{images/}{\assetpath/@@sdir@@/images/}{../project_assets/images/}{../project_assets/emoji/emoji_pngs/}}
\usepackage{booktabs}
\usepackage{url}
\usepackage{makecell}
\usepackage{lipsum}
\usepackage{setspace}
\usepackage{mathtools}
\usepackage{longtable}
\usepackage{pdfpages}

% hyperrefは最後
\usepackage[colorlinks=true,linkcolor=blue,urlcolor=blue]{hyperref}

% ------- フッター（1回だけ定義） -------
\newcommand{\myfootertext}{@@sdir@@}
\setbeamertemplate{footline}{%
  \leavevmode
  \hbox to \paperwidth{%
    \hspace*{0.2cm}
    \scriptsize\color{gray!50} \myfootertext
    \hfill
    \scriptsize\color{gray} \insertframenumber{} / \inserttotalframenumber
    \hspace*{0.4cm}
  }%
  \vspace{1pt}
}

% ------- 任意の共通マクロ・パッケージ -------
\usepackage{../teacherframe}
%\usepackage{teacherframe} % TEXINPUTSか相対パスで見つかるように
% --- タイトル左に「通し番号. タイトル」 ---
\setbeamertemplate{frametitle}{%
  \vspace{0.6ex}%
  \begin{beamercolorbox}[wd=\paperwidth,sep=0.5ex,leftskip=0.9em,rightskip=0.5em]{frametitle}%
    \usebeamerfont{frametitle}%
    \insertframenumber.\,\insertframetitle%
  \end{beamercolorbox}%
}

\usepackage{listings}
\usepackage{xcolor}  % 色を使っている場合も必要
\lstdefinestyle{cmdstyle}{
  backgroundcolor=\color[RGB]{30,30,30}, % 黒に近い濃い灰色
  basicstyle=\ttfamily\color{yellow},    % 太字
  breaklines=true,
  frame=single,
  showstringspaces=false,
  rulecolor=\color{gray}
}

\RequirePackage{listings}
\lstset{
  basicstyle=\ttfamily\footnotesize,
  frame=single,
  breaklines=true,
  showstringspaces=false,
  tabsize=2,
  xleftmargin=0pt
}

\setbeamertemplate{itemize item}{\huge\textbullet}

%---noteのタイトルを変える
%---ノート用の「タイトル変数」を用意
\newcommand{\notetitletext}{} % 初期値は空

\newcommand{\notetitle}[1]{%
  \renewcommand{\notetitletext}{#1}%
}


%---frame タイトルを外部ファイルへ書き出す---(コメント化)
%%\newwrite\frmlistfile
%%\immediate\openout\frmlistfile=frame_titles.txt
%%\let\oldframetitle\frametitle
%%\renewcommand{\frametitle}[1]{%
%%  \oldframetitle{#1}%
%%  \immediate\write\frmlistfile{%
%%    \theframenumber, "#1"%
%%	}
%%}
%--------------------------------------   
%  \immediate\write\frmlistfile{#1}%
%  \immediate\write\frmlistfile{%
%    \theframenumber, "#1"%
%	}

\usepackage{minted} % ※ -shell-escape が必要

\setminted{
  frame=single,       % 枠を付ける
  framesep=2mm,       % 枠と本文の間隔
  fontsize=\footnotesize,
  breaklines=true     % 長い行を折り返す
}

% --- フレームタイトルと番号をログに出力するマクロ ---
\newcommand{\debugframetitle}[1]{%
  \begingroup
  \edef\tempframe{\number\value{framenumber}}%
  \typeout{=== FRAME \tempframe: #1 ===}%
  \endgroup
}

% プリアンブル
\newcounter{myframenum}
\setcounter{myframenum}{0}
\setcounter{framenumber}{0}

\addtobeamertemplate{frametitle}{}{%
  \stepcounter{myframenum}%
  \renewcommand{\insertframetitle}{\themyframenum.\,\insertframetitle}%
}

% ブロックの設定
\definecolor{myblue}{HTML}{7488FF}
\definecolor{mylightblue}{HTML}{E3EEFF}
\setbeamertemplate{blocks}[rounded] % 角丸
\setbeamercolor{block title}{
  bg=myblue,
  fg=white
}
\setbeamercolor{block body}{
  bg=mylightblue,
  fg=black
}


\usepackage[most]{tcolorbox}
% カスタム環境
\newtcolorbox{mycodebox}{
  colback=blue!5, colframe=blue!70!black,
  arc=1mm, boxrule=1pt, left=2mm, right=2mm, top=1mm, bottom=1mm,
  listing only, listing options={style=cmdstyle}
}

% 切替トグル（Pythonから差し込み）
%@@pausemode@@
%@@teachermode@@
%@@notesmode@@
%-------------
%@@notesmode_tech@@

%----------------------------------------------------------------------------------------
%    TITLE PAGE
%----------------------------------------------------------------------------------------
\title{ @@stitle@@ }
\date{}

% 便利マクロ（必要なら）
\newcommand{\codedir}{\assetpath/@@sdir@@}

\begin{document}
\begin{frame}[plain,noframenumbering]
  \titlepage
  \bigskip
  \begin{center}
    \ifteachermode 教師用 \fi
  \end{center}
\end{frame}

% セクションページのデザイン（タイトル上下に線付き）
%\setbeamertemplate{section page}{
%  \begin{centering}
%    \begin{beamercolorbox}[sep=12pt,center]{part title}
%      \usebeamerfont{section title}\insertsection\par
%    \end{beamercolorbox}
%  \end{centering}
%}

% セクションページを自前で定義（上下に線＋太字大文字）
\setbeamertemplate{section page}{
  \begin{centering}
    \vfill
    \rule{\linewidth}{2pt}\par        % 上の線
    \vspace{1ex}
    {\usebeamerfont{section title}\Huge\bfseries \insertsection}\par
    \vspace{1ex}
    \rule{\linewidth}{2pt}\par        % 下の線
    \vfill
  \end{centering}
}

% デフォルトの線付きスタイルを利用
\setbeamerfont{section title}{size=\LARGE,series=\bfseries}

% C{幅} という列型を定義（中央寄せ＋固定幅）
\newcolumntype{C}[1]{>{\centering\arraybackslash}p{#1}}
\newcolumntype{M}[1]{>{\raggedright\arraybackslash}m{#1}}


% --- セクションごとに自動で挿入 ---

\AtBeginSection[]{
  \begin{frame}[plain,noframenumbering]
    \sectionpage
  \end{frame}
}
% 本編開始でフレーム番号を0から
\setcounter{framenumber}{0}



\input{emoji_macros}
