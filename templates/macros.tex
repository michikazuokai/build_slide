%----------------------------------------------------------------------------------------
% macros.tex: パス定義・独自コマンド・ロジック制御
%----------------------------------------------------------------------------------------

% --- 1. パスと変数設定 ---
% Python (build_slides2.py) からプレースホルダが置換されます
\newcommand{\assetpath}{@@sourcedir@@}
\newcommand{\pgfpath}{\assetpath/\detokenize{@@sdir@@}/images/} 
\newcommand{\codedir}{\assetpath/\detokenize{@@sdir@@}} 

% 画像検索パスの設定
%  \graphicspath{{images/}{\assetpath/\detokenize{@@sdir@@}/images/}{../project_assets/images/}{../project_assets/emoji/emoji_pngs/}} 
\graphicspath{{../}{../images/}{@@tool_img@@/}{@@emoji_img@@/}{\assetpath/\detokenize{@@sdir@@}/images/}}

% フッター用テキスト
%\newcommand{\myfootertext}{@@sdir@@} 
\newcommand{\myfootertext}{\detokenize{@@sdir@@}}


% --- 2. ラインマーカー（ハイライター）コマンド ---
% 通常のマーカー
\newcommand{\markline}[2][yellow]{% 
  \tikz[baseline=(X.base)]{% 
    \node[inner sep=0pt,outer sep=0pt] (X) {#2}; % 
    \begin{scope}[on background layer] % 
      \fill[#1, opacity=0.35, rounded corners=0.8pt] % 
        ([xshift=-0.15em,yshift=0.00ex]X.south west) rectangle % 
        ([xshift= 0.15em,yshift=2.15ex]X.south east); % 
    \end{scope} % 
  }% 
}

% 線の太さ・位置を調整できる高度なマーカー
\newcommand{\marklineA}[4][yellow]{% 
  \tikz[baseline=(X.base)]{% 
    \node[inner sep=0pt,outer sep=0pt] (X) {#4}; % 
    \begin{scope}[on background layer] % 
      \fill[#1, opacity=0.35, rounded corners=0.8pt] % 
        ([xshift=-0.15em,yshift=#2]X.south west) rectangle % 
        ([xshift= 0.15em,yshift=#3]X.south east); % 
    \end{scope} % 
  }% 
}


% --- 3. 教師用モード制御（奇数ページ開始ロジック） ---
\newif\ifoddslideenforce 
\oddslideenforcefalse   % デフォルトOFF 

\newif\ifoddslideguard 
\oddslideguardfalse 

% 偶数ページなら空白を入れて奇数に戻すコマンド
\newcommand{\ensureoddslide}{% 
  \ifoddslideguard\relax\else 
    \oddslideguardtrue 
    \ifodd\value{page}\relax 
      % 何もしない 
    \else 
      \begin{frame}[plain,noframenumbering] 
        \note{}% 
      \end{frame} 
    \fi 
    \oddslideguardfalse 
  \fi 
}

% frame開始直前に自動挿入
\BeforeBeginEnvironment{frame}{% 
  \ifoddslideenforce 
    \ensureoddslide 
  \fi 
}


% --- 4. ノート関連 (note / noteT) の安全化 ---
\providecommand{\notetitletext}{} 
\providecommand{\noteT}[2]{}      % デフォルトは何もしない 

% frame開始ごとにタイトル変数をクリア
\AtBeginEnvironment{frame}{\gdef\notetitletext{}} 


% --- 5. その他マクロの読み込み ---
\input{emoji_macros}